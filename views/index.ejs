<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guia de Perguntas</title>

    <link rel="stylesheet" href="/css/stylePergunta.css">
    <link rel="stylesheet" href="/css/styleNavBar.css">
    <link rel="stylesheet" href="/css/styleLogin.css">
    <link rel="stylesheet" href="/css/styleCadastroPergunta.css">
</head>

<body>
    <main>
        <%- include('partials/dialogs/exibirPergunta.ejs') %>
            <%- include('partials/dialogs/login.ejs') %>
                <%- include('partials/dialogs/cadastroPergunta.ejs') %>
                    <%- include('partials/dialogs/cadastroResposta.ejs') %>
                        <%- include('partials/navbar.ejs') %>

                            <menu>
                                <% perguntas.forEach(pergunta=> { %>
                                    <section class="card-pergunta">
                                        <div class="titulo-pergunta">
                                            <%= pergunta.pergunta %>
                                        </div>
                                        <p class="conteudo">
                                            <%= pergunta.descricao %>
                                        </p>
                                        <span class="categoria">
                                            <%= pergunta.categoria %>
                                        </span>
                                        <a href="#" class="comentarios">0 Comentários</a>
                                    </section>
                                    <% }) %>
                            </menu>
    </main>
</body>
<script>
    let logado = false;
    (function () {
        var cardPergunta = document.querySelector(".card-pergunta");
        var botaoCancelar = document.getElementById("fechar");
        var dialogPergunta = document.getElementById("dialogPergunta");
        var formLogin = document.getElementById('formLogin');

        cardPergunta?.addEventListener("click", function () {
            dialogPergunta.showModal();
        });

        botaoCancelar.addEventListener("click", function () {
            dialogPergunta.close();
        });
    })();

    //---constantes modal formulário login----------
    // const openModalButtonLogin = document.getElementById('openModalButtonLogin');
    const closeModalButtonsLogin = document.querySelectorAll('.close-button-login');
    const loginModal = document.getElementById('loginModal');
    const respostaFormLogin = document.getElementById('formLogin')

    //-----constantes modal formulário pergunta----------
    const openModalButtonPergunta = document.getElementById('openModalButtonPergunta');
    const closeModalButtons = document.querySelectorAll('.close-buttons');
    const PerguntaModal = document.getElementById('PerguntaModal');
    const respostaFormPergunta = document.getElementById('formPergunta')

    //-----constantes modal formulário resposta----------
    const openModalButtonResposta = document.getElementById('adicionarResposta');
    const closeModalButtonsResposta = document.querySelectorAll('.close-buttons');
    const RespostaModal = document.getElementById('RespostaModal');
    const respostaFormResposta = document.getElementById('formResposta')

    // Função para redefinir o formulário(apaga os dados sempre que fechar o forms)
    function resetForm(modal) {
        const form = modal.querySelector('form');
        if (form) {
            form.reset();
        }
    }

    //Funçao que verifica se o usuario está logado
    function verificarLogin() {
        if (!logado) {
            loginModal.showModal();
        } else {
        }
    }

    window.location.href

    closeModalButtonsLogin.forEach(button => {
        button.addEventListener('click', () => {
            logado = true;
            loginModal.close();
            resetForm(loginModal);
        })
    })

    //funções modal formulário de Resposta
    openModalButtonResposta.addEventListener('click', () => {
        verificarLogin();
        if (logado) {
            RespostaModal.showModal();
        }
    });


    closeModalButtonsResposta.forEach(button => {
        button.addEventListener('click', () => {
            RespostaModal.close();
            resetForm(RespostaModal);
        })
    })

    //funções modal formulário pergunta
    openModalButtonPergunta.addEventListener('click', () => {
        if (logado == true) {
            PerguntaModal.showModal();
        } else {
            loginModal.showModal();
        }
    });

    closeModalButtons.forEach(button => {
        button.addEventListener('click', () => {
            PerguntaModal.close();
            resetForm(PerguntaModal);
        })
    })
</script>

</html>